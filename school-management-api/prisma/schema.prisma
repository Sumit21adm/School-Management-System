// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Student and Admission Tables
model StudentDetails {
  id              Int       @id @default(autoincrement())
  studentId       String    @unique @db.VarChar(20)
  name            String    @db.VarChar(100)
  fatherName      String    @db.VarChar(100)
  motherName      String    @db.VarChar(100)
  dob             DateTime  @db.Date
  gender          String    @db.VarChar(10)
  className       String    @db.VarChar(20)
  section         String    @db.VarChar(5)
  admissionDate   DateTime  @db.Date
  address         String    @db.Text
  phone           String    @db.VarChar(15)
  email           String?   @db.VarChar(100)
  photoUrl        String?   @db.VarChar(255)
  fatherOccupation String?  @db.VarChar(100)
  motherOccupation String?  @db.VarChar(100)
  aadharCardNo    String?   @unique @db.VarChar(20)
  whatsAppNo      String?   @db.VarChar(15)
  subjects        String?   @db.VarChar(255)
  status          String    @default("active") @db.VarChar(20)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  feeTransactions FeeTransaction[]
  examResults     ExamResult[]
  transportAssignments TransportAssignment[]

  @@map("student_details")
}

// Fee Tables
model FeeTransaction {
  id            Int      @id @default(autoincrement())
  transactionId String   @unique @db.VarChar(50)
  studentId     String   @db.VarChar(20)
  receiptNo     String   @unique @db.VarChar(50)
  amount        Decimal  @db.Decimal(10, 2)
  description   String   @db.VarChar(100)
  paymentMode   String   @db.VarChar(20)
  date          DateTime @db.Date
  yearId        Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  student       StudentDetails @relation(fields: [studentId], references: [studentId])

  @@index([studentId])
  @@index([date])
  @@map("feetransaction_new")
}

// Exam Tables
model Exam {
  id          Int      @id @default(autoincrement())
  examName    String   @db.VarChar(100)
  className   String   @db.VarChar(20)
  examDate    DateTime @db.Date
  totalMarks  Int
  status      String   @default("scheduled") @db.VarChar(20)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  results     ExamResult[]

  @@map("exam_creator")
}

model ExamResult {
  id            Int      @id @default(autoincrement())
  studentId     String   @db.VarChar(20)
  examId        Int
  subject       String   @db.VarChar(50)
  marksObtained Int
  totalMarks    Int
  grade         String?  @db.VarChar(5)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  student       StudentDetails @relation(fields: [studentId], references: [studentId])
  exam          Exam          @relation(fields: [examId], references: [id])

  @@index([studentId])
  @@index([examId])
  @@map("exam_results")
}

// Transport Tables
model Transport {
  id              Int      @id @default(autoincrement())
  vehicleNo       String   @unique @db.VarChar(20)
  routeName       String   @db.VarChar(100)
  driverName      String   @db.VarChar(100)
  driverPhone     String   @db.VarChar(15)
  capacity        Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  assignments     TransportAssignment[]

  @@map("transport")
}

model TransportAssignment {
  id          Int      @id @default(autoincrement())
  studentId   String   @db.VarChar(20)
  transportId Int
  pickupPoint String?  @db.VarChar(200)
  fee         Decimal? @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  student     StudentDetails @relation(fields: [studentId], references: [studentId])
  transport   Transport     @relation(fields: [transportId], references: [id])

  @@index([studentId])
  @@index([transportId])
  @@map("transport_assignments")
}


// Inventory Tables
model Inventory {
  id          Int      @id @default(autoincrement())
  itemCode    String   @unique @db.VarChar(20)
  itemName    String   @db.VarChar(200)
  category    String   @db.VarChar(50)
  quantity    Int
  unit        String   @db.VarChar(20)
  price       Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  movements   StockMovement[]

  @@map("inventory")
}

model StockMovement {
  id          Int      @id @default(autoincrement())
  itemId      Int
  movementType String  @db.VarChar(20)
  quantity    Int
  remarks     String?  @db.Text
  createdAt   DateTime @default(now())

  item        Inventory @relation(fields: [itemId], references: [id])

  @@index([itemId])
  @@map("stock_movements")
}

// User/Auth Tables
model User {
  id          Int      @id @default(autoincrement())
  username    String   @unique @db.VarChar(50)
  password    String   @db.VarChar(255)
  role        String   @db.VarChar(20)
  name        String   @db.VarChar(100)
  email       String?  @db.VarChar(100)
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("users")
}
